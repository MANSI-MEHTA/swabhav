package com.techlabs.action;

import java.util.Date;

import org.apache.struts2.ServletActionContext;

import com.opensymphony.xwork2.ActionSupport;
import com.techlabs.entity.Account;
import com.techlabs.entity.User;
import com.techlabs.entity.UserTransaction;

public class ViewTransactionAction extends ActionSupport{
	
	@Override
	public String execute(){
		
		return "success";
	}
	
	public String passbook(){
		session = ServletActionContext.getRequest().getSession();
		double amount = userbean.getAmount();
		System.out.println(amount);
		long acc_no = (long) session.getAttribute("acc_no");

		System.out.println("Account No in withdraw Action is " + acc_no);
		Account account = accountservice.getAccountByAcc_no(acc_no);
		User user = userservice.getUserByAcc_no(acc_no);
		System.out.println(account.getAcc_no());

		double oldbalance = account.getBalance();
		if(oldbalance<1000){
			addActionError("You cannot withdraw,Balance is below 1000");
			return "input";
		}
		double newbalance = oldbalance - userbean.getAmount();
		if(newbalance<1000){
			addActionError("you have to maintain minimum balance i.e 1000rs");
			return "input";
		}
		account.setBalance(newbalance);
		account.setUser(user);

		accountservice.updateBalanceByAcc_no(account);

		Date date = new Date();
		long transaction_id = transactionservice.generateTransactionId();

		UserTransaction transaction = new UserTransaction(transaction_id,
				"personal", userbean.getAmount(), "withdraw", date, user);

		transactionservice.printPassbook(transaction);


	}

}
